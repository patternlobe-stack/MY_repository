<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Insert title here</title>
    <link rel="stylesheet" href="../css/public.css" />

    <style>
      .result {
        display: flex;
      }
      .res {
        flex: 25%;
      }
    </style>
    <script>

      const getData = (url) =>{

          return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();

                //요청-응답
                xhr.open('get', url, true);
                xhr.send();
                xhr.onload = () =>{
                	//콜백함수가 곧바로 수행되지 않는다 - 태스크큐(마이크로테스크큐)에 저장되었다 
                	//콜스택이 비어지면 호출해서 실행 한다 
                	resolve(xhr.responseText)
                	
                	///홍길동/홍매화/홍도화/개나리/진달래/봉숭아/무궁화
                }
                xhr.onerror = function(){
                      reject(xhr.statusText)
                }
          })//promise
     }//getData
      
     
     const proc4 = () =>{
    	 
    	 getData("obj_arr.jsp")
    	/* .then(res =>{
    		return JSON.parse(res);
    	}) */
    	.then(res => JSON.parse(res))
    	.then(datas =>{

			let code ="";
			
			/* datas.forEach( (data, index) =>{
				 code += `${index+1}번째 데이타<br>`
				 code += `이름 :${data['name']} <br>`
		    	 code += `주소 : ${data['addr']} <br>`
		    	 code += `전화번호 : ${ data['tel']}<br>`
				
			}) */
			
			datas.forEach( ({name, addr, tel}, index) =>{
				 code += `<br>${index+1}번째 데이타<br>`
				 code += `이름 :${name} <br>`
		    	 code += `주소 : ${addr} <br>`
		    	 code += `전화번호 : ${tel}<br>`
				
			})
			
			document.querySelector('#result4').innerHTML = code;
    	})
    	.catch( err=> console.log(err))
     }
     
     
     
     
      const proc2 = () =>{
    	  getData("arr.jsp")
    	  .then( res =>{ // //getData호출 - 실행결과를 res로 받는다
    		  //res =   ["홍길동","개나리","진달래","무궁화","삼천리" ,"금수강산"];
    	  // json 형식의 텍스트 기반의 문자열데이타 
    	  
    	  //res를 자바스크립트 배열객체로 변화  - 역직렬화
    	  res = JSON.parse(res);
    	  console.log(res);
    	  
    	  	  code = "<ol>"
    	      res.forEach( name =>{
    	    	  
    	    	  code += `<li>${name}</li>`
    	      })
    	      code += "</ol>"
    	      
    	      document.querySelector("#result2").innerHTML = code;
    	  })
    	  .catch( err=> {
    		  console.log(err);
    	  })
    	  .finally( res =>{
    		  console.log("end");
    	  })
    	  
      }//proc2 
      
      const proc3 = () =>{
    	  
    	  getData("obj.jsp")
    	  .then( res =>{
    		    //res :json객체 형식이지만 텍스트 기반의 문자열 데이타;
    	        //javascript객체로 변환- 역직렬화 
    	        
    	        return JSON.parse(res);
    	  })
    	  .then( ({name, addr, tel}) =>{
    		  let code = ""
       		  code += `이름 :${name} <br>`
       		  code += `주소 : ${addr} <br>`
       		  code += `전화번호 : ${tel}<br>`
        		  
        	  document.querySelector('#result3').innerHTML = code;
    	  })
    	 /*  .then ( data =>{
    		  //data 는 java script객체다
    		  
    		// let code = ""
    		//  code += `이름 :${data.name} <br>`
    		//  code += `주소 : ${data.addr} <br>`
    		//  code += `전화번호 : ${date.tel}<<br>`
    		  
   			  let code = ""
    		  code += `이름 :${data['name']} <br>`
    		  code += `주소 : ${data['addr']} <br>`
    		  code += `전화번호 : ${ data['tel']}<br>`
    		  
    		  document.querySelector('#result3').innerHTML = code;
     	  }) */
     	  .catch( err=>{
     		  console.log(err);
     	  })
    	  
      }
      
      const proc1 = () =>{
          promi = getData("text.jsp");
		  console.log("promi", promi);
		  
          promi.then(res => { //getData호출 - 실행결과를 res로 받는다
        	  //res -> ///홍길동/홍매화/홍도화/개나리/진달래/봉숭아/무궁화
               console.log(res);
        	  
        	  //구분자 /를 기준으로 문자열을 분리 해서 배열로 생성
        	  arr =  res.split("/");
        	  code = "<ul>";
        	  
        	  arr.forEach( name =>{
        		  code += `<li>${name}</li>`;
        	  })
        	  
        	  code += "</ul>";
        	        	  
        	  document.querySelector('#result1').innerHTML = code;
          })
          .catch(err=> {
				console.log(err);
          })
          .finally((res) => {
				console.log("end");
          })

      }
    </script>
  </head>
  <body>
    <div class="box">
      <h3></h3>
      <input type="button" value="text" onclick="proc1()" />
      <input type="button" value="배열" onclick="proc2()" />
      <input type="button" value="object" onclick="proc3()" />
      <input type="button" value="obj_배열" onclick="proc4()" />
      <br /><br />

      <div class="result">
        <div id="result1" class="res"></div>
        <div id="result2" class="res"></div>
        <div id="result3" class="res"></div>
        <div id="result4" class="res"></div>
      </div>
    </div>
  </body>
</html>
