<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet"  href="../css/public.css">

<style>
table{
border : 2px solid blue;
border-collapse:  collapse;
}

td{
  width : 100px;
  height : 50px;
  text-align: center;
}
th{
  height : 50px;
  background: skyblue;
}
</style>
<script>

const getMember = (url) =>{
	
	return  new Promise(function(resolve, reject) { 
		
		const xhr = new XMLHttpRequest();
		
		xhr.open('get', url , true);
		xhr.send();
		
		xhr.onload = function(){
			
			resolve(xhr.responseText);
		}
		
		xhr.onerror = () =>{
			reject(xhr.status);  // 200, 404, 403 , 500
		}
	});
	
}
const proc1 = () =>{
	//promise
	getMember("member.jsp")
	.then( res =>{
		//member.jsp에서 직렬화 데이타를 받음 - json형식의 문자열데이타 
		//javascript객체로 역직렬화 
		return JSON.parse(res);
		//return
	})
	.then( datas =>{
		
		//출략모양 출력 
		//출력모양 - 출력
		code = "<table border='1'>"
	    code += "<tr><th>아이디</th><th>이름</th><th>전화번호</th><th>이메일</th></tr>";
	    
	    datas.forEach( (item, index) =>{
	    	code += `<tr><td>${item['mem_id']}</td><td>${item['mem_name']}</td>`;
	    	code += `<td>${item['mem_hp']}</td><td>${item['mem_mail']}</td></tr>`;
	    })
	    code += "</table>";
	    document.querySelector('#result1').innerHTML = code ;
		
	})
	.catch(err=>{
		console.log(err);
	})
	
}

const proc2 = () =>{
	location.href="http://localhost/webpro/0904/memberPage.jsp"
}

const proc3 = () =>{
	fetch("http://localhost/webpro/0904/member.jsp")
	.then(res =>{
		//res는 실제 데이타가 아니고 Response객체
		//javascript객체로 역직렬화  - 
		if(res.ok) return res.json();
		//return
	})
	.then(datas =>{
		//datas는 실제데이타 
		 //출력모양 만들어서 출력
		 
		code = "<table border='1'>"
	    code += "<tr><th>아이디</th><th>이름</th><th>전화번호</th><th>이메일</th></tr>";
	    
	    datas.forEach( (item, index) =>{
	    	code += `<tr><td>${item['mem_id']}</td><td>${item['mem_name']}</td>`;
	    	code += `<td>${item['mem_hp']}</td><td>${item['mem_mail']}</td></tr>`;
	    })
	    code += "</table>";
	    
	    document.querySelector('#result1').innerHTML = code ;
			
		
	})
	.catch(err=>{
		console.log(err);
	})
}
</script>

</head>
<body>


<div class="box">
      <h3>
      </h3>
      <input type="button" value="promise" onclick="proc1()" />
      <input type="button" value="동기" onclick="proc2()" />
      <input type="button" value="fetch" onclick="proc3()" />
      <br /><br />

      <div id="result1"></div>
</div>
</body>
</html>