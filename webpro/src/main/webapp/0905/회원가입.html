<!DOCTYPE html> 
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- <link rel="stylesheet"  href="../css/public.css">
 --> <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
 <style>
 input[type=text], input[type=date],input[type=password]{
 width : 300px;
 
 }
#add1, #add2 {
  width:700px;
}
 
 
</style> 

<script>

const _$ = (ele)=>{
	return document.querySelector(ele);
}
document.addEventListener("DOMContentLoaded", function() {
	idbtn= document.querySelector('#idchk');
	
	
	//버튼 이벤트 핸들러 작성 
	_$('#id').onkeyup = function(){
		idvalue=_$('#id').value;
		//입력값 가져오기 
		regId = /^[a-zA-Z][a-zA-Z0-9]{3,9}$/ ///^ $// 공백X
			//입력형식을 체크(정규식)-영문자로 시작해서 숫자와 조합한다..
			
			//올바른 형식의 데이터이면,, 서버를 실행 (서블릿-selectById.do) 
			if(!(regId.test(idvalue))){ 
				//alert("형식 오류 ")
				_$('#id').style.border = "2px solid red";
				idbtn.setAttribute('disabled','disabled');
			}else{
				_$('#id').style.border = "2px solid blue";
				idbtn.removeAttribute('disabled');

			}
	}
	//onkeyup
	
	//idbnt.addEventListener('keyup',function(){})
	
	
	//별도의   upPro함수작성
	//idbnt.onkeyup =upPro('keyup',upPro)
//
})
	
function upPro(){
	
}

const sendProc = async ()=>{ 
	/* 전송버튼 클릭 이벤트. 입력한 9개의 값을 가져온다.	 */
/* 	vid=_$("id").value;
	vname=_$("name").value;
	vpwd=_$("pwd").value;
	vmail=_$("email").value;
	vhp=_$("hp").value;
	vbir=_$("bir").value;
	vzip=_$("zip").value;
	vadd1=_$("add1").value;
	vadd2=_$("add2").value;
	
	datas = {mem_id : vid, mem_pass:vpwd, mem_name:vname, ..............}이거말구 ..  */
	
	vff = _$("#ff") /* form id사용 ff  */
	fd = new FormData(vff);
	fbody =Object.fromEntries(fd);
	console.log(fbody);
	
	//서버로 전송 
	res=await fetch("http://localhost/webpro/MemberJoin.do",{
		method : 'POST',
		headers : {"content-type":"application/json;charset=utf-8"},
		body: JSON.stringify(fbody)	
		})
	//자바스크립트 형태로 역직렬화 
	datas = await res.json();
	
	console.log(datas);

	//출력
}

//아이디 중복검사 
const idCheck = async ()=>{ //async
	
	
	//입력한 아이디 가져온다. 
	//let idvalue = _$('#id').value; //ele를 찾아라...
	//console.log(idvalue);

	//사용가능 인지 불가능인지 출력을 하라...... 
	
	
	try {
		res = await fetch("http://localhost/webpro/selectById.do?id=" + idvalue) //await, ?id=>>>>ㄴ딛츄ㅛㅣㅇ 	String userId = request.getParameter("id");
		//res 실제 실행결과가 아니고 reponse객체
		
		data = await res.json() //스크립트 객체로 역직렬화 
		
		console.log(data);
		
		_$('#idspan').innerHTML = data['flag'];
		_$('#idspan').style.color ='red';
	} catch (e) {
		e.printStackTrace();
	}
}

</script>

</head>
<body>


<div class="box">

<div class="container mt-3">
  <h2>Stacked form</h2>
<form id="ff">
  <div class="mb-3 mt-3">
    <label for="id">아이디:</label>
    <input type="button"  class="btn btn-outline-success btn-sm" value="중복검사"  id="idchk"  onclick="idCheck()">
    <span id ="idspan"></span>
    <input  type="text"  class="form-control"   id="id" name="mem_id">
  </div>


      <div class="mb-3 mt-3">
      <label for="name">이름:</label>
      <input type="text" class="form-control" id="name" name="mem_name">
    </div>
  
  
    <div class="mb-3 mt-3">
      <label for="email">Email:</label>
      <input type="text" class="form-control" id="email"  name="mem_mail">
    </div>
    <div class="mb-3">
      <label for="pwd">Password:</label>
      <input type="password" class="form-control" id="pwd"  name="mem_pass">
    </div>
    
     <div class="mb-3 mt-3">
      <label for="hp">전화번호:</label>
      <input type="text" class="form-control" id="hp"  name="mem_hp">
    </div>
    <div class="mb-3">
      <label for="bir">생일:</label>
      <input type="date" class="form-control" id="bir"  name="mem_bir">
    </div>
    
    <div class="mb-3">
      <label for="zip">우편번호:</label>
      <input type="text" class="form-control" id="zip"  name="mem_zip"> <!-- //name은 vo와 일치해야함  -->
    </div>
    
     <div class="mb-3 mt-3">
      <label for="add1">주소:</label>
      <input type="text" class="form-control" id="add1"  name="mem_add1">
    </div>
    <div class="mb-3">
      <label for="add2">상세주소:</label>
      <input type="text" class="form-control" id="add2"  name="mem_add2">
    </div>
    
    
    <button type="button" class="btn btn-primary btn-lg" onclick="sendProc()">Submit</button>
    <span id="respan"></span>
    </form>
  </div>
</div>
</body>
</html>